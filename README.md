# Express API æ¨¡æ¿é¡¹ç›®

è¿™æ˜¯ä¸€ä¸ªåŸºäº Express.js æ¡†æ¶çš„ API æœåŠ¡æ¨¡æ¿é¡¹ç›®ï¼Œé›†æˆäº†å¤šä¸ªå®ç”¨åŠŸèƒ½å’Œæœ€ä½³å®è·µã€‚

## é¡¹ç›®ç‰¹æ€§

- ğŸš€ åŸºäº Express 5.x æ„å»º
- ğŸ“ é›†æˆ ApiDoc è‡ªåŠ¨ç”Ÿæˆ API æ–‡æ¡£
- ğŸ”’ æ”¯æŒ JWT èº«ä»½éªŒè¯
- ğŸ“¤ æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ï¼ˆæ”¯æŒä¸ƒç‰›äº‘å­˜å‚¨ï¼‰
- ğŸŒ CORS è·¨åŸŸæ”¯æŒ
- ğŸ”„ æ”¯æŒçƒ­é‡è½½å¼€å‘
- ğŸ“¦ Vercel éƒ¨ç½²æ”¯æŒ

## æŠ€æœ¯æ ˆ

- Express.js - Web åº”ç”¨æ¡†æ¶
- MongoDB (Mongoose) - æ•°æ®åº“
- JWT - èº«ä»½éªŒè¯
- Multer - æ–‡ä»¶ä¸Šä¼ 
- ApiDoc - API æ–‡æ¡£ç”Ÿæˆ
- dotenv - ç¯å¢ƒå˜é‡é…ç½®

## å¿«é€Ÿå¼€å§‹

### å®‰è£…ä¾èµ–

```bash
npm install
```

### å¼€å‘ç¯å¢ƒè¿è¡Œ

```bash
npm run dev
```

### ç”Ÿäº§ç¯å¢ƒè¿è¡Œ

```bash
npm start
```

### ç”Ÿæˆ API æ–‡æ¡£

```bash
npm run apidoc
```

## ç¯å¢ƒå˜é‡é…ç½®

åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `.env` æ–‡ä»¶ ,å‚è€ƒ`.env.example`

## é¡¹ç›®ç»“æ„

```
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app.js          # åº”ç”¨å…¥å£æ–‡ä»¶
â”‚   â”œâ”€â”€ routes/         # è·¯ç”±æ–‡ä»¶
â”‚   â”œâ”€â”€ controllers/    # æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ models/         # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ middlewares/    # ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ utils/          # å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ public/         # é™æ€æ–‡ä»¶
â”‚       â””â”€â”€ apidoc/     # API æ–‡æ¡£
â”œâ”€â”€ .env                # ç¯å¢ƒå˜é‡
â”œâ”€â”€ .gitignore
â”œâ”€â”€ package.json
â”œâ”€â”€ vercel.json         # Vercel éƒ¨ç½²é…ç½®
â””â”€â”€ apidoc.json         # ApiDoc é…ç½®
```

## API æ–‡æ¡£

API æ–‡æ¡£è‡ªåŠ¨ç”Ÿæˆå¹¶éƒ¨ç½²åœ¨ `/apidoc` è·¯å¾„ä¸‹ã€‚æœ¬åœ°å¼€å‘æ—¶å¯ä»¥é€šè¿‡ `http://localhost:3000/apidoc` è®¿é—®ã€‚

## API æ¥å£æ–‡æ¡£

### é¢˜åº“æ¨¡å—æ¥å£

#### è·å–é¢˜åº“åˆ—è¡¨

**æ¥å£åœ°å€ï¼š** `GET /api/question/list`

**æŸ¥è¯¢å‚æ•°ï¼š**
- `page` (å¯é€‰): é¡µç ï¼Œé»˜è®¤ä¸º1
- `limit` (å¯é€‰): æ¯é¡µæ•°é‡ï¼Œé»˜è®¤ä¸º10
- `category` (å¯é€‰): åˆ†ç±»ç­›é€‰
- `tags` (å¯é€‰): æ ‡ç­¾ç­›é€‰
- `difficulty` (å¯é€‰): éš¾åº¦ç­›é€‰
- `keyword` (å¯é€‰): å…³é”®è¯æœç´¢
- `sortBy` (å¯é€‰): æ’åºå­—æ®µï¼Œé»˜è®¤ä¸ºcreatedAt
- `sortOrder` (å¯é€‰): æ’åºæ–¹å¼ï¼Œascæˆ–descï¼Œé»˜è®¤ä¸ºdesc

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```
GET /api/question/list?page=1&limit=10&category=å‰ç«¯&difficulty=3
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 2000,
  "message": "æ“ä½œæˆåŠŸ",
  "data": {
    "questions": [
      {
        "id": 1,
        "title": "JavaScripté—­åŒ…æ˜¯ä»€ä¹ˆï¼Ÿ",
        "content": "è¯·è§£é‡ŠJavaScriptä¸­é—­åŒ…çš„æ¦‚å¿µåŠå…¶åº”ç”¨åœºæ™¯ã€‚",
        "difficulty": 3,
        "category": "å‰ç«¯",
        "tags": "JavaScript,é—­åŒ…",
        "createdAt": "2023-06-01T08:00:00.000Z",
        "updatedAt": "2023-06-01T08:00:00.000Z"
      }
    ],
    "pagination": {
      "total": 100,
      "page": 1,
      "limit": 10,
      "totalPages": 10
    }
  }
}
```

#### è·å–é¢˜ç›®è¯¦æƒ…

**æ¥å£åœ°å€ï¼š** `GET /api/question/:id`

**è·¯å¾„å‚æ•°ï¼š**
- `id`: é¢˜ç›®ID

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```
GET /api/question/1
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 2000,
  "message": "æ“ä½œæˆåŠŸ",
  "data": {
    "id": 1,
    "title": "JavaScripté—­åŒ…æ˜¯ä»€ä¹ˆï¼Ÿ",
    "content": "è¯·è§£é‡ŠJavaScriptä¸­é—­åŒ…çš„æ¦‚å¿µåŠå…¶åº”ç”¨åœºæ™¯ã€‚",
    "answer": "é—­åŒ…æ˜¯æŒ‡æœ‰æƒè®¿é—®å¦ä¸€ä¸ªå‡½æ•°ä½œç”¨åŸŸä¸­å˜é‡çš„å‡½æ•°...",
    "difficulty": 3,
    "category": "å‰ç«¯",
    "tags": "JavaScript,é—­åŒ…",
    "createdAt": "2023-06-01T08:00:00.000Z",
    "updatedAt": "2023-06-01T08:00:00.000Z"
  }
}
```

#### åˆ›å»ºé¢˜ç›®

**æ¥å£åœ°å€ï¼š** `POST /api/question/create`

**è¯·æ±‚ä½“ï¼š**
```json
{
  "title": "JavaScripté—­åŒ…æ˜¯ä»€ä¹ˆï¼Ÿ",
  "content": "è¯·è§£é‡ŠJavaScriptä¸­é—­åŒ…çš„æ¦‚å¿µåŠå…¶åº”ç”¨åœºæ™¯ã€‚",
  "answer": "é—­åŒ…æ˜¯æŒ‡æœ‰æƒè®¿é—®å¦ä¸€ä¸ªå‡½æ•°ä½œç”¨åŸŸä¸­å˜é‡çš„å‡½æ•°...",
  "difficulty": 3,
  "category": "å‰ç«¯",
  "tags": "JavaScript,é—­åŒ…"
}
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 2001,
  "message": "é¢˜ç›®åˆ›å»ºæˆåŠŸ",
  "data": {
    "id": 1,
    "title": "JavaScripté—­åŒ…æ˜¯ä»€ä¹ˆï¼Ÿ",
    "content": "è¯·è§£é‡ŠJavaScriptä¸­é—­åŒ…çš„æ¦‚å¿µåŠå…¶åº”ç”¨åœºæ™¯ã€‚",
    "answer": "é—­åŒ…æ˜¯æŒ‡æœ‰æƒè®¿é—®å¦ä¸€ä¸ªå‡½æ•°ä½œç”¨åŸŸä¸­å˜é‡çš„å‡½æ•°...",
    "difficulty": 3,
    "category": "å‰ç«¯",
    "tags": "JavaScript,é—­åŒ…",
    "createdAt": "2023-06-01T08:00:00.000Z",
    "updatedAt": "2023-06-01T08:00:00.000Z"
  }
}
```

#### æ›´æ–°é¢˜ç›®

**æ¥å£åœ°å€ï¼š** `PUT /api/question/:id`

**è·¯å¾„å‚æ•°ï¼š**
- `id`: é¢˜ç›®ID

**è¯·æ±‚ä½“ï¼š**
```json
{
  "title": "æ›´æ–°åçš„æ ‡é¢˜",
  "content": "æ›´æ–°åçš„å†…å®¹",
  "answer": "æ›´æ–°åçš„ç­”æ¡ˆ"
}
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 2000,
  "message": "é¢˜ç›®æ›´æ–°æˆåŠŸ",
  "data": {
    "id": 1,
    "title": "æ›´æ–°åçš„æ ‡é¢˜",
    "content": "æ›´æ–°åçš„å†…å®¹",
    "answer": "æ›´æ–°åçš„ç­”æ¡ˆ",
    "difficulty": 3,
    "category": "å‰ç«¯",
    "tags": "JavaScript,é—­åŒ…",
    "createdAt": "2023-06-01T08:00:00.000Z",
    "updatedAt": "2023-06-01T09:00:00.000Z"
  }
}
```

#### åˆ é™¤é¢˜ç›®

**æ¥å£åœ°å€ï¼š** `DELETE /api/question/:id`

**è·¯å¾„å‚æ•°ï¼š**
- `id`: é¢˜ç›®ID

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```
DELETE /api/question/1
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 2000,
  "message": "é¢˜ç›®åˆ é™¤æˆåŠŸ",
  "data": true
}
```

### ç®¡ç†å‘˜æ¥å£

#### è·å–ç”¨æˆ·åˆ—è¡¨

**æ¥å£åœ°å€ï¼š** `GET /api/admin/user/users`

**è¯·æ±‚å¤´ï¼š**
```
Authorization: Bearer <token>
```

**æŸ¥è¯¢å‚æ•°ï¼š**
- `page` (å¯é€‰): é¡µç ï¼Œé»˜è®¤ä¸º1
- `limit` (å¯é€‰): æ¯é¡µæ•°é‡ï¼Œé»˜è®¤ä¸º10
- `search` (å¯é€‰): æœç´¢å…³é”®è¯ï¼Œæ”¯æŒç”¨æˆ·åã€æ˜µç§°ã€é‚®ç®±æœç´¢

**æƒé™è¦æ±‚ï¼š** éœ€è¦ç®¡ç†å‘˜æƒé™

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```
GET /api/admin/user/users?page=1&limit=10&search=test
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 2000,
  "message": "è·å–ç”¨æˆ·åˆ—è¡¨æˆåŠŸ",
  "data": {
    "users": [
      {
        "id": 1,
        "username": "testuser",
        "email": "test@example.com",
        "nickname": "æµ‹è¯•ç”¨æˆ·",
        "avatar": "https://example.com/avatar.jpg",
        "role": "user",
        "createdAt": "2024-01-01T00:00:00.000Z",
        "updatedAt": "2024-01-01T00:00:00.000Z",
        "createTime": 1704067200
      }
    ],
    "pagination": {
      "currentPage": 1,
      "pageSize": 10,
      "total": 1,
      "totalPages": 1
    }
  }
}
```

**é”™è¯¯å“åº”ï¼š**
```json
{
  "code": 4001,
  "message": "æœªç»èº«ä»½éªŒè¯çš„ç”¨æˆ·"
}
```

```json
{
  "code": 4003,
  "message": "æƒé™ä¸è¶³ï¼Œéœ€è¦ç®¡ç†å‘˜æƒé™"
}
```

## è®¸å¯è¯

[ISC](LICENSE)